---
openapi: 3.0.1
info:
  title: API Documentation
  version: '1.0'
paths:
  "/api/active_users":
    get:
      summary: アクティブユーザー一覧を取得する
      tags:
      - ActiveUser
      responses:
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
        '200':
          description: アクティブユーザー一覧取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    avatarUrl:
                      type: string
                      nullable: true
                    isFollowing:
                      type: boolean
                  required:
                  - id
                  - name
                  - avatarUrl
                  - isFollowing
      parameters:
      - name: limit
        in: query
        required: false
        description: 取得件数（最大30）
        schema:
          type: integer
  "/api/posts/{post_id}/comments":
    parameters:
    - name: post_id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: コメントを作成する
      tags:
      - Comment
      parameters: []
      responses:
        '201':
          description: 作成成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  content:
                    type: string
                required:
                - id
                - content
        '401':
          description: 未認証
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: object
                  properties:
                    content:
                      type: string
                  required:
                  - content
              required:
              - comment
  "/api/posts/{post_id}/comments/{id}":
    parameters:
    - name: post_id
      in: path
      required: true
      schema:
        type: integer
    - name: id
      in: path
      required: true
      schema:
        type: integer
    delete:
      summary: コメントを削除する
      tags:
      - Comment
      responses:
        '204':
          description: 削除成功
        '401':
          description: 未認証
  "/api/posts/{post_id}/like":
    parameters:
    - name: post_id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: いいねを作成する
      tags:
      - Like
      responses:
        '200':
          description: いいね完了
          content:
            application/json:
              schema:
                type: object
                properties:
                  isLiked:
                    type: boolean
                required:
                - isLiked
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    delete:
      summary: いいねを削除する
      tags:
      - Like
      responses:
        '200':
          description: いいね解除
          content:
            application/json:
              schema:
                type: object
                properties:
                  isLiked:
                    type: boolean
                required:
                - isLiked
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/auth/logout":
    delete:
      summary: ログアウトする
      tags:
      - Auth
      parameters:
      - name: Authorization
        in: header
        required: true
        schema:
          type: string
          example: Bearer <jwt>
      responses:
        '204':
          description: ログアウト成功
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/me/name_availability":
    get:
      summary: ユーザー名の利用可否を確認する
      tags:
      - User
      parameters:
      - name: name
        in: query
        required: true
        schema:
          type: string
        description: 確認するユーザー名
      responses:
        '200':
          description: 利用可否を返却
          content:
            application/json:
              schema:
                type: object
                properties:
                  available:
                    type: boolean
                required:
                - available
        '400':
          description: nameパラメータが未指定
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                required:
                - errors
        '401':
          description: 未ログイン
  "/api/me":
    get:
      summary: ログイン中ユーザーを取得する
      tags:
      - User
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  avatarUrl:
                    type: string
                    nullable: true
                  isFollowing:
                    type: boolean
                  followingsCount:
                    type: integer
                  followersCount:
                    type: integer
                  postsCount:
                    type: integer
                required:
                - id
                - name
                - avatarUrl
                - isFollowing
                - followingsCount
                - followersCount
                - postsCount
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    patch:
      summary: ユーザー情報を更新する
      tags:
      - User
      parameters: []
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  avatarUrl:
                    type: string
                    nullable: true
                  isFollowing:
                    type: boolean
                  followingsCount:
                    type: integer
                  followersCount:
                    type: integer
                  postsCount:
                    type: integer
                required:
                - id
                - name
                - avatarUrl
                - isFollowing
                - followingsCount
                - followersCount
                - postsCount
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name:
                  type: string
                avatar:
                  type: string
                  format: binary
                remove_avatar:
                  type: boolean
                  description: trueでアバターを削除
  "/api/notifications/read_all":
    post:
      summary: 全通知を一括既読にする
      tags:
      - Notification
      responses:
        '204':
          description: 一括既読成功
        '401':
          description: 未ログイン
  "/api/notifications/unread_count":
    get:
      summary: 未読通知数を取得する
      tags:
      - Notification
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  unreadCount:
                    type: integer
                required:
                - unreadCount
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/notifications":
    get:
      summary: 通知一覧を取得する
      tags:
      - Notification
      parameters:
      - name: page
        in: query
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    notificationType:
                      type: string
                      enum:
                      - liked
                      - commented
                      - followed
                    actorCount:
                      type: integer
                    recentActors:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          avatarUrl:
                            type: string
                            nullable: true
                        required:
                        - name
                        - avatarUrl
                    postId:
                      type: integer
                      nullable: true
                    postImageUrl:
                      type: string
                      nullable: true
                    commentContent:
                      type: string
                      nullable: true
                    read:
                      type: boolean
                    timeAgo:
                      type: string
                  required:
                  - id
                  - notificationType
                  - actorCount
                  - recentActors
                  - read
                  - timeAgo
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/posts":
    get:
      summary: 投稿一覧を取得する
      tags:
      - Post
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    caption:
                      type: string
                      nullable: true
                    imageUrls:
                      type: array
                      items:
                        type: string
                    userName:
                      type: string
                    userAvatar:
                      type: string
                      nullable: true
                    likedCount:
                      type: integer
                    likesSummary:
                      type: string
                      nullable: true
                    timeAgo:
                      type: string
                    isLiked:
                      type: boolean
                    isOwn:
                      type: boolean
                    mostRecentLikerName:
                      type: string
                    commentsCount:
                      type: integer
                  required:
                  - id
                  - imageUrls
                  - userName
                  - userAvatar
                  - likedCount
                  - timeAgo
                  - isLiked
                  - isOwn
                  - mostRecentLikerName
                  - commentsCount
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    post:
      summary: 投稿を作成する
      tags:
      - Post
      parameters: []
      responses:
        '201':
          description: 作成成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  caption:
                    type: string
                    nullable: true
                  imageUrls:
                    type: array
                    items:
                      type: string
                  userName:
                    type: string
                  userAvatar:
                    type: string
                    nullable: true
                  likedCount:
                    type: integer
                  likesSummary:
                    type: string
                    nullable: true
                  timeAgo:
                    type: string
                  isLiked:
                    type: boolean
                  isOwn:
                    type: boolean
                  mostRecentLikerName:
                    type: string
                  comments:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        content:
                          type: string
                        userName:
                          type: string
                        userAvatar:
                          type: string
                          nullable: true
                        isOwner:
                          type: boolean
                      required:
                      - id
                      - content
                      - userName
                      - userAvatar
                      - isOwner
                required:
                - id
                - imageUrls
                - userName
                - userAvatar
                - likedCount
                - timeAgo
                - isLiked
                - isOwn
                - mostRecentLikerName
                - comments
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: string
  "/api/posts/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: 投稿詳細を取得する
      tags:
      - Post
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  caption:
                    type: string
                    nullable: true
                  imageUrls:
                    type: array
                    items:
                      type: string
                  userName:
                    type: string
                  userAvatar:
                    type: string
                    nullable: true
                  likedCount:
                    type: integer
                  likesSummary:
                    type: string
                    nullable: true
                  timeAgo:
                    type: string
                  isLiked:
                    type: boolean
                  isOwn:
                    type: boolean
                  mostRecentLikerName:
                    type: string
                  comments:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        content:
                          type: string
                        userName:
                          type: string
                        userAvatar:
                          type: string
                          nullable: true
                        isOwner:
                          type: boolean
                      required:
                      - id
                      - content
                      - userName
                      - userAvatar
                      - isOwner
                required:
                - id
                - imageUrls
                - userName
                - userAvatar
                - likedCount
                - timeAgo
                - isLiked
                - isOwn
                - mostRecentLikerName
                - comments
        '404':
          description: 投稿が存在しない
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                required:
                - errors
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    patch:
      summary: 投稿を更新する
      tags:
      - Post
      parameters: []
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  caption:
                    type: string
                    nullable: true
                  imageUrls:
                    type: array
                    items:
                      type: string
                  userName:
                    type: string
                  userAvatar:
                    type: string
                    nullable: true
                  likedCount:
                    type: integer
                  likesSummary:
                    type: string
                    nullable: true
                  timeAgo:
                    type: string
                  isLiked:
                    type: boolean
                  isOwn:
                    type: boolean
                  mostRecentLikerName:
                    type: string
                  comments:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        content:
                          type: string
                        userName:
                          type: string
                        userAvatar:
                          type: string
                          nullable: true
                        isOwner:
                          type: boolean
                      required:
                      - id
                      - content
                      - userName
                      - userAvatar
                      - isOwner
                required:
                - id
                - imageUrls
                - userName
                - userAvatar
                - likedCount
                - timeAgo
                - isLiked
                - isOwn
                - mostRecentLikerName
                - comments
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                post:
                  type: object
                  properties:
                    caption:
                      type: string
    delete:
      summary: 投稿を削除する
      tags:
      - Post
      responses:
        '204':
          description: 削除成功
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/users/{user_id}/relationship":
    parameters:
    - name: user_id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: フォロー関係を作成する
      tags:
      - Relationship
      responses:
        '201':
          description: フォロー成功
        '401':
          description: 未ログイン
        '422':
          description: 自分自身または重複フォローで失敗
    delete:
      summary: フォロー関係を削除する
      tags:
      - Relationship
      responses:
        '204':
          description: フォロー削除成功
        '401':
          description: 未ログイン
        '404':
          description: フォローしていない相手を削除しようとした場合
  "/api/timeline":
    get:
      summary: タイムラインを取得する
      tags:
      - Timeline
      parameters:
      - name: cursor
        in: query
        required: false
        description: 前回取得した最後の投稿のID
        schema:
          type: string
      responses:
        '200':
          description: タイムライン取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  posts:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        caption:
                          type: string
                          nullable: true
                        imageUrls:
                          type: array
                          items:
                            type: string
                        userName:
                          type: string
                        userAvatar:
                          type: string
                          nullable: true
                        likedCount:
                          type: integer
                        likesSummary:
                          type: string
                          nullable: true
                        timeAgo:
                          type: string
                        isLiked:
                          type: boolean
                        isOwn:
                          type: boolean
                        mostRecentLikerName:
                          type: string
                        commentsCount:
                          type: integer
                      required:
                      - id
                      - imageUrls
                      - userName
                      - userAvatar
                      - likedCount
                      - timeAgo
                      - isLiked
                      - isOwn
                      - mostRecentLikerName
                      - commentsCount
                  nextCursor:
                    type: string
                    nullable: true
                  hasMore:
                    type: boolean
                required:
                - posts
                - hasMore
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/auth/token":
    get:
      summary: 認可コードからJWTを取得する
      tags:
      - Auth
      parameters:
      - name: auth_code
        in: query
        required: true
        schema:
          type: string
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  jwt:
                    type: string
                  exp:
                    type: integer
                required:
                - jwt
                - exp
        '401':
          description: 認可コードが無効
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                required:
                - errors
  "/api/users/{user_id}/followers":
    parameters:
    - name: user_id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: 特定ユーザーのフォロワー一覧を取得する
      tags:
      - User Follower
      parameters:
      - name: page
        in: query
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: フォロワー一覧取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    avatarUrl:
                      type: string
                      nullable: true
                    isFollowing:
                      type: boolean
                  required:
                  - id
                  - name
                  - avatarUrl
                  - isFollowing
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
        '404':
          description: 存在しないユーザー
  "/api/users/{user_id}/followings":
    parameters:
    - name: user_id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: 特定ユーザーのフォロー中一覧を取得する
      tags:
      - User Following
      parameters:
      - name: page
        in: query
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: フォロー中一覧取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    avatarUrl:
                      type: string
                      nullable: true
                    isFollowing:
                      type: boolean
                  required:
                  - id
                  - name
                  - avatarUrl
                  - isFollowing
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
        '404':
          description: 存在しないユーザー
  "/api/users/{user_id}/posts":
    parameters:
    - name: user_id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: 特定ユーザーの投稿一覧を取得する
      tags:
      - User Post
      parameters:
      - name: page
        in: query
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    caption:
                      type: string
                      nullable: true
                    imageUrls:
                      type: array
                      items:
                        type: string
                    userName:
                      type: string
                    userAvatar:
                      type: string
                      nullable: true
                    likedCount:
                      type: integer
                    likesSummary:
                      type: string
                      nullable: true
                    timeAgo:
                      type: string
                    isLiked:
                      type: boolean
                    isOwn:
                      type: boolean
                    mostRecentLikerName:
                      type: string
                    commentsCount:
                      type: integer
                  required:
                  - id
                  - imageUrls
                  - userName
                  - userAvatar
                  - likedCount
                  - timeAgo
                  - isLiked
                  - isOwn
                  - mostRecentLikerName
                  - commentsCount
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
        '404':
          description: 存在しないユーザー
  "/api/users":
    get:
      summary: ユーザー一覧を取得する
      tags:
      - User
      parameters:
      - name: q
        in: query
        required: false
        description: 名前で検索
        schema:
          type: string
      responses:
        '200':
          description: ユーザー一覧取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    avatarUrl:
                      type: string
                      nullable: true
                    isFollowing:
                      type: boolean
                  required:
                  - id
                  - name
                  - avatarUrl
                  - isFollowing
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/users/{id}":
    get:
      summary: ユーザー詳細を取得する
      tags:
      - User
      parameters:
      - name: id
        in: path
        required: true
        description: ユーザーID
        schema:
          type: integer
      responses:
        '200':
          description: ユーザー詳細取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  avatarUrl:
                    type: string
                    nullable: true
                  isFollowing:
                    type: boolean
                  followingsCount:
                    type: integer
                  followersCount:
                    type: integer
                  postsCount:
                    type: integer
                required:
                - id
                - name
                - avatarUrl
                - isFollowing
                - followingsCount
                - followersCount
                - postsCount
        '404':
          description: 存在しないユーザー
        '401':
          description: 未ログイン
servers:
- url: https://{defaultHost}
  variables:
    defaultHost:
      default: www.example.com

---
openapi: 3.0.1
info:
  title: API Documentation
  version: '1.0'
paths:
  "/api/active_users":
    get:
      summary: アクティブユーザー一覧を取得する
      tags:
      - ActiveUser
      responses:
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
        '200':
          description: アクティブユーザー一覧取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    avatarUrl:
                      type: string
                      nullable: true
                    isFollowing:
                      type: boolean
                  required:
                  - id
                  - name
                  - avatarUrl
                  - isFollowing
      parameters:
      - name: limit
        in: query
        required: false
        description: 取得件数（最大30）
        schema:
          type: integer
  "/api/posts/{post_id}/comments":
    parameters:
    - name: post_id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: コメントを作成する
      tags:
      - Comment
      parameters: []
      responses:
        '201':
          description: 作成成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  content:
                    type: string
                required:
                - id
                - content
        '401':
          description: 未認証
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: object
                  properties:
                    content:
                      type: string
                  required:
                  - content
              required:
              - comment
  "/api/posts/{post_id}/comments/{id}":
    parameters:
    - name: post_id
      in: path
      required: true
      schema:
        type: integer
    - name: id
      in: path
      required: true
      schema:
        type: integer
    delete:
      summary: コメントを削除する
      tags:
      - Comment
      responses:
        '204':
          description: 削除成功
        '401':
          description: 未認証
  "/api/posts/{post_id}/like":
    parameters:
    - name: post_id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: いいねを作成する
      tags:
      - Like
      responses:
        '200':
          description: いいね完了
          content:
            application/json:
              schema:
                type: object
                properties:
                  isLiked:
                    type: boolean
                required:
                - isLiked
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    delete:
      summary: いいねを削除する
      tags:
      - Like
      responses:
        '200':
          description: いいね解除
          content:
            application/json:
              schema:
                type: object
                properties:
                  isLiked:
                    type: boolean
                required:
                - isLiked
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/auth/logout":
    delete:
      summary: ログアウトする
      tags:
      - Auth
      parameters:
      - name: Authorization
        in: header
        required: true
        schema:
          type: string
          example: Bearer <jwt>
      responses:
        '204':
          description: ログアウト成功
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/me":
    get:
      summary: ログイン中ユーザーを取得する
      tags:
      - User
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  avatarUrl:
                    type: string
                    nullable: true
                  isFollowing:
                    type: boolean
                  followingsCount:
                    type: integer
                  followersCount:
                    type: integer
                  postsCount:
                    type: integer
                required:
                - id
                - name
                - avatarUrl
                - isFollowing
                - followingsCount
                - followersCount
                - postsCount
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    patch:
      summary: ユーザー情報を更新する
      tags:
      - User
      parameters: []
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  avatarUrl:
                    type: string
                    nullable: true
                  isFollowing:
                    type: boolean
                  followingsCount:
                    type: integer
                  followersCount:
                    type: integer
                  postsCount:
                    type: integer
                required:
                - id
                - name
                - avatarUrl
                - isFollowing
                - followingsCount
                - followersCount
                - postsCount
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: string
  "/api/posts":
    get:
      summary: 投稿一覧を取得する
      tags:
      - Post
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    caption:
                      type: string
                      nullable: true
                    imageUrls:
                      type: array
                      items:
                        type: string
                    userName:
                      type: string
                    userAvatar:
                      type: string
                      nullable: true
                    likedCount:
                      type: integer
                    likesSummary:
                      type: string
                      nullable: true
                    timeAgo:
                      type: string
                    isLiked:
                      type: boolean
                    isOwn:
                      type: boolean
                    mostRecentLikerName:
                      type: string
                    comments:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                          content:
                            type: string
                          userName:
                            type: string
                          userAvatar:
                            type: string
                            nullable: true
                          isOwner:
                            type: boolean
                        required:
                        - id
                        - content
                        - userName
                        - userAvatar
                        - isOwner
                  required:
                  - id
                  - imageUrls
                  - userName
                  - userAvatar
                  - likedCount
                  - timeAgo
                  - isLiked
                  - isOwn
                  - mostRecentLikerName
                  - comments
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    post:
      summary: 投稿を作成する
      tags:
      - Post
      parameters: []
      responses:
        '201':
          description: 作成成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  caption:
                    type: string
                    nullable: true
                  imageUrls:
                    type: array
                    items:
                      type: string
                  userName:
                    type: string
                  userAvatar:
                    type: string
                    nullable: true
                  likedCount:
                    type: integer
                  likesSummary:
                    type: string
                    nullable: true
                  timeAgo:
                    type: string
                  isLiked:
                    type: boolean
                  isOwn:
                    type: boolean
                  mostRecentLikerName:
                    type: string
                  comments:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        content:
                          type: string
                        userName:
                          type: string
                        userAvatar:
                          type: string
                          nullable: true
                        isOwner:
                          type: boolean
                      required:
                      - id
                      - content
                      - userName
                      - userAvatar
                      - isOwner
                required:
                - id
                - imageUrls
                - userName
                - userAvatar
                - likedCount
                - timeAgo
                - isLiked
                - isOwn
                - mostRecentLikerName
                - comments
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: string
  "/api/posts/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: 投稿詳細を取得する
      tags:
      - Post
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  caption:
                    type: string
                    nullable: true
                  imageUrls:
                    type: array
                    items:
                      type: string
                  userName:
                    type: string
                  userAvatar:
                    type: string
                    nullable: true
                  likedCount:
                    type: integer
                  likesSummary:
                    type: string
                    nullable: true
                  timeAgo:
                    type: string
                  isLiked:
                    type: boolean
                  isOwn:
                    type: boolean
                  mostRecentLikerName:
                    type: string
                  comments:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        content:
                          type: string
                        userName:
                          type: string
                        userAvatar:
                          type: string
                          nullable: true
                        isOwner:
                          type: boolean
                      required:
                      - id
                      - content
                      - userName
                      - userAvatar
                      - isOwner
                required:
                - id
                - imageUrls
                - userName
                - userAvatar
                - likedCount
                - timeAgo
                - isLiked
                - isOwn
                - mostRecentLikerName
                - comments
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
    patch:
      summary: 投稿を更新する
      tags:
      - Post
      parameters: []
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  caption:
                    type: string
                    nullable: true
                  imageUrls:
                    type: array
                    items:
                      type: string
                  userName:
                    type: string
                  userAvatar:
                    type: string
                    nullable: true
                  likedCount:
                    type: integer
                  likesSummary:
                    type: string
                    nullable: true
                  timeAgo:
                    type: string
                  isLiked:
                    type: boolean
                  isOwn:
                    type: boolean
                  mostRecentLikerName:
                    type: string
                  comments:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        content:
                          type: string
                        userName:
                          type: string
                        userAvatar:
                          type: string
                          nullable: true
                        isOwner:
                          type: boolean
                      required:
                      - id
                      - content
                      - userName
                      - userAvatar
                      - isOwner
                required:
                - id
                - imageUrls
                - userName
                - userAvatar
                - likedCount
                - timeAgo
                - isLiked
                - isOwn
                - mostRecentLikerName
                - comments
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                post:
                  type: object
                  properties:
                    caption:
                      type: string
    delete:
      summary: 投稿を削除する
      tags:
      - Post
      responses:
        '204':
          description: 削除成功
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/users/{user_id}/relationship":
    parameters:
    - name: user_id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: フォロー関係を作成する
      tags:
      - Relationship
      responses:
        '201':
          description: フォロー成功
        '401':
          description: 未ログイン
        '422':
          description: 自分自身または重複フォローで失敗
    delete:
      summary: フォロー関係を削除する
      tags:
      - Relationship
      responses:
        '204':
          description: フォロー削除成功
        '401':
          description: 未ログイン
        '404':
          description: フォローしていない相手を削除しようとした場合
  "/api/auth/token":
    get:
      summary: 認可コードからJWTを取得する
      tags:
      - Auth
      parameters:
      - name: auth_code
        in: query
        required: true
        schema:
          type: string
      responses:
        '200':
          description: 取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  jwt:
                    type: string
                  exp:
                    type: integer
                required:
                - jwt
                - exp
        '401':
          description: 認可コードが無効
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                required:
                - errors
  "/api/users":
    get:
      summary: ユーザー一覧を取得する
      tags:
      - User
      parameters:
      - name: q
        in: query
        required: false
        description: 名前で検索
        schema:
          type: string
      responses:
        '200':
          description: ユーザー一覧取得成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    name:
                      type: string
                    avatarUrl:
                      type: string
                      nullable: true
                    isFollowing:
                      type: boolean
                  required:
                  - id
                  - name
                  - avatarUrl
                  - isFollowing
        '401':
          description: 未ログイン
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
  "/api/users/{id}":
    get:
      summary: ユーザー詳細を取得する
      tags:
      - User
      parameters:
      - name: id
        in: path
        required: true
        description: ユーザーID
        schema:
          type: integer
      responses:
        '200':
          description: ユーザー詳細取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  avatarUrl:
                    type: string
                    nullable: true
                  isFollowing:
                    type: boolean
                  followingsCount:
                    type: integer
                  followersCount:
                    type: integer
                  postsCount:
                    type: integer
                required:
                - id
                - name
                - avatarUrl
                - isFollowing
                - followingsCount
                - followersCount
                - postsCount
        '404':
          description: 存在しないユーザー
        '401':
          description: 未ログイン
servers:
- url: https://{defaultHost}
  variables:
    defaultHost:
      default: www.example.com
